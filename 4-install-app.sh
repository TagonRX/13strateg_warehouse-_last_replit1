#!/bin/bash

# ═══════════════════════════════════════════════════════════════════════════
# Шаг 4: Установка приложения
# ═══════════════════════════════════════════════════════════════════════════

set -e

echo "════════════════════════════════════════════════════════════"
echo "  ШАГ 4: УСТАНОВКА ПРИЛОЖЕНИЯ"
echo "════════════════════════════════════════════════════════════"
echo ""

echo "→ Установка зависимостей..."
npm install

echo ""
echo "→ Сборка приложения..."
npm run build

echo ""
echo "→ Синхронизация базы данных..."
npm run db:push --force 2>/dev/null || npm run db:push

echo ""
echo "→ Установка PM2 (Process Manager)..."
sudo npm install -g pm2

echo ""
echo "════════════════════════════════════════════════════════════"
echo "✓ Приложение установлено и готово к запуску"
echo "════════════════════════════════════════════════════════════"
echo ""
echo "→ Последний шаг: ./5-run-server.sh"
