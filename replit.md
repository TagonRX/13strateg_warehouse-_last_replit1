# Warehouse Management System

## Overview
This project is a comprehensive warehouse management system designed to streamline inventory tracking, stock management, and operational analytics. It offers role-based access for warehouse workers and administrators. Key capabilities include individual and bulk stock intake with barcode assignment, location-based picking, real-time inventory tracking, warehouse capacity monitoring, daily picking list management, robust worker performance analytics, and a complete event audit log. The business vision is to optimize warehouse operations, reduce manual errors, and provide actionable insights for improved efficiency and cost savings.

## User Preferences
Preferred communication style: Simple, everyday language.

## System Architecture

### UI/UX Decisions
The frontend uses React 18 with TypeScript and Vite. It leverages Radix UI primitives and shadcn/ui components ("New York" style, inspired by Carbon Design System) for a consistent and modern look. Typography is based on IBM Plex Sans/Mono, and the color palette is optimized for operational clarity, supporting both light and dark modes. Key UI patterns include role-based sidebar navigation, responsive design, card-based interfaces, real-time toast notifications, and resizable, persistent table columns. Barcode and QR code scanning is integrated with universal scanner support (USB, Zebra TC57, keyboard-emulating devices) plus mobile camera mode via WebSocket. The picking interface features a compact vertical layout with collapsible sections. Inventory table uses localized overflow-x-auto wrapper to prevent horizontal scroll overlap with sidebar while maintaining scroll capability for other pages.

### Technical Implementations
The backend is built with Node.js and Express.js, using TypeScript and ES Modules. It exposes a RESTful JSON API with session-based and Bearer token authentication, featuring role-based middleware. Drizzle ORM manages PostgreSQL database interactions. The project follows a monorepo structure, sharing TypeScript types and utilizing Zod for schema validation. Real-time communication is handled via a WebSocket server for features like remote scanning and picking list synchronization. A unique auto-location extraction feature derives warehouse locations from SKUs.

### Feature Specifications
*   **Inventory Management**: Supports bulk imports via a comprehensive CSV import wizard with intelligent product matching, real-time updates, location consistency checks, price tracking, archiving, and automatic condition transfer. Includes multiple URL import mode with 4-character labels, localStorage persistence, and sequential loading to prevent server overload. CSV files can have different column orders - system merges all unique columns. Visual tracking for items added without testing. Automatically displays product thumbnails from 24 separate Image URLs fields (imageUrl1-24), eBay links, Item ID, and eBay Seller columns with sticky headers. Features quick-access eBay URL button next to product names, opening a secure dialog with direct link to external listings. **Smart CSV Import Logic**: When CSV import finds an existing itemId match, updates ONLY quantity and price (preserving all other data integrity). When SKU exists with barcode/dimensions, enriches missing metadata (name, itemId, URLs) without overwriting existing barcode/dimensions. **Automated CSV Scheduler**: Administrators can configure scheduled CSV imports via node-cron with database-driven settings (enabled/disabled, cron expression like "0 6 * * *" for daily 6 AM). UI in Mass Upload section allows enabling/disabling scheduler, setting cron expression, viewing last run status/errors, and manually triggering imports. All scheduled imports are logged with run status and metadata. **Deferred Archiving with 4-Day Grace Period**: Items with quantity <= 0 are marked with zeroQuantitySince timestamp instead of immediate archiving. A separate automated cron task runs daily at 2 AM to archive items that have been at zero quantity for 4+ days. This grace period accommodates weekend orders where supplier inventory updates before warehouse fulfillment (e.g., picking list references items already removed from supplier's CSV but still physically in warehouse). During picking workflows, items reaching zero have zeroQuantitySince set; when restocked (quantity > 0), timestamp is cleared. Archived items are moved to archivedInventoryItems table preserving full data history and appended to data/OLD-inventory.csv file. **Archive Restoration**: Stock-In workflow automatically queries archived items by SKU and offers restoration option when matches found, displaying product name, location, last quantity, and archived timestamp. Restoration re-adds items to active inventory with proper cache invalidation and event logging. **Duplicate SKU Filter**: InventoryTable includes toggle filter "Дубликаты SKU" that shows only SKUs with multiple different Item IDs, with count badge displaying number of duplicate groups. Uses memoized filtering for performance. **Duplicate Prevention**: Advanced conflict resolution system prevents duplicate entries during CSV imports. When itemId matches existing inventory: (1) If SKU also matches, shows data mismatch conflicts for field-by-field resolution (accept CSV or keep existing), (2) If SKU differs, presents duplicate itemId conflict with options to create duplicate (same itemId in different location), replace existing record, or skip. All conflicts preserve existing barcodes and require administrator decision before processing. **Duplicate Management**: Administrators can find and remove existing duplicates in the inventory database via "Найти дубликаты" button. System detects duplicate groups based on matching itemId or SKU values, displays them in an organized dialog with checkboxes for selection, and allows bulk deletion while preserving non-selected records. **Item ID Filtering**: Administrators can delete all items without Item ID from inventory via dedicated "Удалить без Item ID" button with confirmation dialog showing count of items to be deleted. CSV import includes optional checkbox "Не импортировать товары без Item ID" that filters out rows with empty/missing Item ID during upload, with validation ensuring Item ID column is mapped before filtering to prevent empty uploads.
*   **Location Management**: Administrators can mass-upload locations and barcodes via CSV, with individual location barcode edits requiring a batch save. Display is optimized with memoized components and debounced filters for large datasets.
*   **Cost Analytics**: Tracks costs through event logs for stock-in/out operations and worker performance.
*   **Picking Lists**: Manages daily picking lists with enhanced CSV/Excel/URL import capabilities (including multiple URL sequential import), global credentials, persistent selections, and inventory depletion warnings. Displays product photos, eBay external links, and eBay Seller information.
*   **Warehouse Loading View**: Provides dynamic filtering, configuration of warehouse settings for capacity analysis, and validation against managed locations, optimized with memoized components and debounced filters.
*   **User Management**: Basic user administration with robust deletion safeguards.
*   **Event Logging**: Comprehensive audit trail of all warehouse operations with full product information and cost traceability, supporting CSV export and visual indicators for critical warnings and untested products.
*   **Worker Analytics**: Displays key metrics and cost totals for all users, including packing statistics, and searchable event history.
*   **Barcode and QR Code Scanner Workflow**: Supports dual-mode scanning ("Сканер" for USB/keyboard devices and "Камера" for mobile camera via WebSocket) with zoom controls, accessible tooltips, and capacity validation.
*   **Product Testing Workflow**: Optional two-phase system for incoming products, allowing direct inventory addition or a testing workflow tracking items from pending tests to final condition with working hours analytics.
*   **Pending Placement Management**: Administrators can delete pending placements directly from Stock In and Placement sections. Each deletion triggers a confirmation dialog displaying placement details (barcode, SKU, name, location) and creates an event log entry (PENDING_PLACEMENT_DELETED) with full metadata for audit trail. Delete buttons visible only to users with admin role, secured by backend requireAuth + requireAdmin middleware.
*   **Dispatch Workflow**: Complete order preparation system with 4-phase non-stop barcode scanning for finding orders, verifying multi-item orders, scanning shipping labels, and confirming dispatch. Displays product photos, eBay links, and tracks scanned quantities.
*   **Packing Workflow**: Multi-worker order fulfillment with barcode verification against Dispatch data, supporting concurrent packing sessions with real-time updates, product photos, and error prevention.

### System Design Choices
The database schema, managed by Drizzle ORM, includes tables for users, inventory, event logs, worker analytics, picking lists, and specific workflows. It uses UUID primary keys, automatic timestamps, and foreign key relationships. Product identification is by `itemId` (eBay Item ID) or `sku`, and upsert patterns handle bulk inventory updates. The file sync endpoint matches items first by itemId, then by SKU if itemId is not available. Inventory items have 24 separate image URL fields (imageUrl1-24) for storing product photos. The CSV import system is a 4-step wizard with source selection (including single URL, file upload, or multiple labeled URLs), intelligent column mapping (including bilingual suggestions, auto-detection, and Image URLs 1-24 support), intelligent matching and conflict resolution (using Levenshtein distance and handling dimension conflicts), and a final confirmation and commit step. Column mappings are persisted in localStorage for reuse across sessions. Multiple URL import supports different column orders across CSVs by merging all unique columns, 4-character labels with localStorage persistence, and sequential loading with progress tracking. Backend CSV processing is optimized for large files using batch processing and parallel chunk execution. CSV URL imports use POST endpoint with 60-second timeout (AbortController), comprehensive logging (fetch duration, parsing metrics), and URL masking for security.

## External Dependencies

*   **Database**: Neon Serverless PostgreSQL (development), PostgreSQL 16 (production).
*   **UI Components**: Radix UI, shadcn/ui, Lucide React, cmdk, vaul.
*   **Form Handling**: React Hook Form, @hookform/resolvers, Zod.
*   **Data Fetching**: TanStack Query.
*   **Authentication**: BCrypt.
*   **Styling**: Tailwind CSS, class-variance-authority, tailwind-merge.
*   **Date Handling**: date-fns.
*   **Barcode Scanning**: html5-qrcode.
*   **CSV Parsing**: fast-csv.
*   **String Matching**: string-similarity.
*   **Image Carousel**: embla-carousel-react.
*   **Build Tools**: Vite, esbuild, TypeScript, Drizzle Kit.